{

    "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",

    "contentVersion": "1.0.0.0",

    "parameters": {

      "storageAccountType": {
      "type": "string",
      "defaultValue": "Standard_LRS",
      "allowedValues": [
        "Standard_LRS",
        "Standard_GRS",
        "Standard_ZRS",
        "Premium_LRS"
      ],
      "metadata": {
        "description": "Storage Account type"
      }
    },
 "storageaccountname": {
      "type": "string",
      "defaultValue": "nestlepocsa",
      "metadata": {
        "description": "Storage Account Name"
      }
    },
"vnetName": {

      "type": "string",

      "defaultValue": "nestlepocvnet",

      "metadata": {

        "description": "VNet name"

      }

    },

    "vnetAddressPrefix": {

      "type": "string",

      "defaultValue": "10.155.0.0/25",

      "metadata": {

        "description": "Address prefix"

      }

    },

    "subnet1Prefix": {

      "type": "string",

      "defaultValue": "10.155.0.0/26",

      "metadata": {

        "description": "nestlepocsubnet1 Prefix"

      }

    },

    "subnet1Name": {

      "type": "string",

      "defaultValue": "nestlepocsubnet1",

      "metadata": {

        "description": "nestlepocsubnet1"

      }

    },

    "subnet2Prefix": {

      "type": "string",
 
     "defaultValue": "10.155.0.64/26",

      "metadata": {

        "description": "nestlepocsubnet2 Prefix"

      }

    },
 
   "subnet2Name": {

      "type": "string",

      "defaultValue": "nestlepocsubnet2",

      "metadata": {

        "description": "nestlepocsubnet2 Name"

      }

    },
 
 "subnet3Prefix": {

      "type": "string",

      "defaultValue": "10.155.1.64/26",

      "metadata": {

        "description": "nestlepocsubnet3 Prefix"
 
     }

    },

    "subnet3Name": {

      "type": "string",

      "defaultValue": "nestlepocsubnet3",

      "metadata": {

        "description": "nestlepocsubnet3 SubnetName"

      }

    },
 "adminUsername": {
      "type": "string",
      "metadata": {
        "description": "Username for the Virtual Machine."
      }
    },
    "adminPassword": {
      "type": "securestring",
      "metadata": {
        "description": "Password for the Virtual Machine."
      }
    },
    "dnsLabelPrefix": {
      "type": "string",
      "metadata": {
        "description": "Unique DNS Name for the Public IP used to access the Virtual Machine."
      }
    },
   "virtualMachineName": {
      "type": "string",
      "metadata": {
        "description": "Virtual Machine Name."
      }
    },
 "virtualMachineSize": {
      "type": "string",
      "metadata": {
        "description": "Virtual Machine Size."
      }
    },
  "publicIPAddressName": {
      "type": "string",
      "metadata": {
        "description": "Public IP Address Name."
      }
    }, "nicName": {
      "type": "string",
      "metadata": {
        "description": "nic Name."
      }
    },
    "windowsOSVersion": {
      "type": "string",
      "defaultValue": "2016-Datacenter",
      "allowedValues": [
        "2008-R2-SP1",
        "2012-Datacenter",
        "2012-R2-Datacenter",
        "2016-Nano-Server",
        "2016-Datacenter-with-Containers",
        "2016-Datacenter"
      ],
      "metadata": {
        "description": "The Windows version for the VM. This will pick a fully patched image of this given Windows version."
      }
    }

    },

  "variables": {

    "apiVersion": "2017-10-23",
 
   "storageAccountName": "[parameters('storageaccountname')]",

    "location": "[resourceGroup().location]",

    "storageAccountType": "[parameters('storageAccountType')]",

    "sharedBaseUrl" : "#BaseUrl for ARM Templates",

   "storageaccountTemplate" : {

      "templateUrl" : "[concat(variables('sharedBaseUrl'),'storageaccount-azuredeploy.json')]",

      "paramUrl" : "[concat(variables('sharedBaseUrl'),'azuredeploy-storageaccount.json')]"

    },

   "vNetSubNetTemplate" : {

      "templateUrl" : "[concat(variables('sharedBaseUrl'),'VNet3Subnet-azuredeploy.json')]",

      "paramUrl" : "[concat(variables('sharedBaseUrl'),'VNet3Subnet.parameters.json')]"

    },
  "vmTemplate" : {

      "templateUrl" : "[concat(variables('sharedBaseUrl'),'vmcreation-azuredeploy.json')]",

      "paramUrl" : "[concat(variables('sharedBaseUrl'),'vmcreation.parameters.json')]"

    }
  },

   "resources": [ 
      {

      "apiVersion": "[variables('apiVersion')]",

      "name": "storageaccountLinked",

      "type": "Microsoft.Resources/deployments",

      "dependsOn": [

        "[concat('Microsoft.Storage/storageAccounts/', variables('storageAccountName'))]"

      ],

      "properties": {

        "mode": "Incremental",

        "templateLink": {

          "uri": "[variables('storageaccountTemplate').templateUrl]",

          "contentVersion": "1.0.0.0"

        },

        "parametersLink": {

          "uri": "[variables('storageaccountTemplate').paramUrl]",

          "contentVersion": "1.0.0.0"

        }

      }

    },

  {

      "apiVersion": "[variables('apiVersion')]",

      "name": "vnetsubnetLinked",

      "type": "Microsoft.Resources/deployments",

      "dependsOn": [

        "[concat('Microsoft.Storage/storageAccounts/', variables('storageAccountName'))]",

        "[concat('Microsoft.Network/virtualNetworks/', variables('virtualNetworkName'))]"

      ],

      "properties": {

        "mode": "Incremental",

        "templateLink": {

          "uri": "[variables('vNetSubNetTemplate').templateUrl]",

          "contentVersion": "1.0.0.0"

        },

        "parametersLink": {

          "uri": "[variables('vNetSubNetTemplate').paramUrl]",

          "contentVersion": "1.0.0.0"

        }

      }

    },
 {

      "apiVersion": "[variables('apiVersion')]",

      "name": "vmLinked",

      "type": "Microsoft.Resources/deployments",

      "dependsOn": [

        "[concat('Microsoft.Storage/storageAccounts/', variables('storageAccountName'))]",

        "[concat('Microsoft.Network/virtualNetworks/', variables('virtualNetworkName'))]"


      ],

      "properties": {

        "mode": "Incremental",

        "templateLink": {

          "uri": "[variables('vmtemplate').templateUrl]",

          "contentVersion": "1.0.0.0"

        },

        "parametersLink": {

          "uri": "[variables('vmtemplate').paramUrl]",

          "contentVersion": "1.0.0.0"

        }

      }

   }   

]
}